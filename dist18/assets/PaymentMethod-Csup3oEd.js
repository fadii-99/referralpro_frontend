import{u as O,r as l,R as z,j as e}from"./index-BWkKWa2F.js";import{S as E}from"./SideDesign-6w4rZga0.js";import{B as F}from"./Button-DKZIAQRV.js";import{M as I}from"./MultiStepHeader-HPd8r49X.js";import{L as W,y as n}from"./ReactToastify-FoD0jKfJ.js";const L="/api",h=a=>a.replace(/\D/g,""),R=a=>h(a).slice(0,16).replace(/(\d{4})(?=\d)/g,"$1 ").trim(),A=a=>{if(!/^\d{4}-\d{2}$/.test(a))return"";const[d,t]=a.split("-");return`${t}/${d.slice(-2)}`},J=()=>{const a=O(),d=l.useContext(z);if(!d)throw new Error("Wrap your app with <RegistrationProvider /> first.");const{registrationData:t,finishSignup:M}=d,[g,w]=l.useState(""),[p,j]=l.useState(""),[o,y]=l.useState(""),[i,N]=l.useState(""),[b,C]=l.useState(!1),[k,f]=l.useState(!1),[V,v]=l.useState(!1),T=l.useMemo(()=>h(p).length,[p]),Y=s=>j(R(s)),D=s=>N(h(s).slice(0,4)),P=async()=>{if(b)return;if(!g.trim()||!p.trim()||!o||!i.trim()){n.error("Please fill out card name, number, expiry and CVV.");return}if(T!==16){n.error("Card number must be 16 digits.");return}if(i.length<3||i.length>4){n.error(i.length<3?"CVV is too short (3–4 digits required).":"CVV is too long (3–4 digits required).");return}const[s,c]=o.split("-");if(!s||s==="0000"){n.error("Please select expiry year.");return}if(!c||c==="00"){n.error("Please select expiry month.");return}C(!0);try{const r=t.profileType==="company",u=A(o),B={welcome:{role:"Business",profileType:t.profileType||""},basic:{firstName:t.firstName,lastName:t.lastName,industry:t.industry,email:t.email,...r?{companyName:t.companyName}:{}},businessType:{type:r?t.bizType:"sole",years:t.years,employees:t.employees,usState:t.usState},companyInfo:{address1:t.address1,address2:t.address2,city:t.city,postCode:t.postCode,phone:t.phone,website:t.website},subscription:{billing:t.subscriptionBilling,planId:t.subscriptionPlanId===null?null:Number(t.subscriptionPlanId),seats:Number(t.subscriptionSeats),currency:t.subscriptionCurrency||"USD",total:Number(t.subscriptionTotal||0),totalDisplay:t.subscriptionTotalDisplay||""},payment:{paymentType:t.paymentType,charge:{currency:t.subscriptionCurrency||"USD",total:Number(t.subscriptionTotal||0),totalDisplay:t.subscriptionTotalDisplay||""},card:{name:g.trim(),number:h(p),expiry:{monthValue:o,mmYY:u},cvv:i}},password:{value:t.password||""}},S=new FormData;S.append("payload",JSON.stringify(B));const m=await fetch(`${L}/auth/sign_up/`,{method:"POST",body:S}),x=await m.json();if(m.status===502||m.status===503||m.status===504){n.error("Server is busy, please try again.");return}if(!m.ok){const $=x.error||x.detail||x.message||"Payment submit failed";n.error($);return}x?.tokens?.access&&localStorage.setItem("accessToken",x.tokens.access),n.success("Signup successful!"),setTimeout(()=>{M({clear:!0}),w(""),j(""),y(""),N(""),a("/Dashboard",{replace:!0})},1e3)}catch(r){console.error(r),n.error("Something went wrong. Try again.")}finally{C(!1)}};return e.jsxs("div",{className:"grid md:grid-cols-5 w-full min-h-screen",children:[e.jsx(E,{}),e.jsxs("div",{className:"md:col-span-3 flex flex-col bg-[#F4F2FA]",children:[e.jsx("div",{className:"sticky top-5 z-30 backdrop-blur w-full max-w-lg mx-auto",children:e.jsx("div",{className:"px-4",children:e.jsx(I,{title:"Payment Method",current:6,total:6,onBack:()=>a(-1)})})}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",children:e.jsxs("div",{className:"w-full max-w-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[11px] text-primary-blue font-semibold mb-2",children:["Card Name ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary-purple/80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[e.jsx("path",{d:"M12 12a4 4 0 100-8 4 4 0 000 8Z"}),e.jsx("path",{d:"M3 20a9 9 0 0118 0"})]})}),e.jsx("input",{type:"text",placeholder:"Card Name",value:g,onChange:s=>w(s.target.value),className:"w-full pl-12 pr-4 py-4 rounded-full bg-white border border-gray-200 text-xs md:text-sm text-gray-800 placeholder-gray-400 outline-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[11px] text-primary-blue font-semibold mb-2",children:["Card Number ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary-purple/80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[e.jsx("rect",{x:"3",y:"5",width:"18",height:"14",rx:"2"}),e.jsx("path",{d:"M3 10h18"})]})}),e.jsx("input",{inputMode:"numeric",maxLength:19,placeholder:"0000 0000 0000 0000",value:p,onChange:s=>Y(s.target.value),className:"w-full pl-12 pr-4 py-4 rounded-full bg-white border border-gray-200 text-xs md:text-sm text-gray-800 placeholder-gray-400 outline-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[11px] text-primary-blue font-semibold mb-2",children:["Expiry ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"relative flex items-center gap-2",children:[e.jsx("span",{className:"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 z-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary-purple/80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:e.jsx("path",{d:"M7 4v3M17 4v3M4 9h16M5 20h14a2 2 0 0 0 2-2v-9H3v9a2 2 0 0 0 2 2Z"})})}),e.jsxs("div",{className:"relative w-1/2",children:[e.jsx("button",{type:"button",onClick:()=>{f(s=>!s),v(!1)},className:"w-full pl-12 pr-8 py-4 rounded-full bg-white border border-gray-200 text-left text-xs md:text-sm text-gray-800 outline-none",children:o.split("-")[1]||"MM"}),k&&e.jsx("ul",{className:"absolute z-40 mt-2 w-full bg-white border border-gray-200 rounded-2xl shadow-lg overflow-auto max-h-44 text-[11px] sm:text-sm",children:Array.from({length:12},(s,c)=>{const r=String(c+1).padStart(2,"0");return e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>{const[u]=o.split("-");y(`${u||""}-${r}`),f(!1)},className:"w-full text-left px-3 py-2 hover:bg-primary-purple/5",children:r})},r)})})]}),e.jsxs("div",{className:"relative w-1/2",children:[e.jsx("button",{type:"button",onClick:()=>{v(s=>!s),f(!1)},className:"w-full pl-4 pr-8 py-4 rounded-full bg-white border border-gray-200 text-left text-xs md:text-sm text-gray-800 outline-none",children:o.split("-")[0]||"YYYY"}),V&&e.jsx("ul",{className:"absolute z-40 mt-2 w-full bg-white border border-gray-200 rounded-2xl shadow-lg overflow-auto max-h-44 text-[11px] sm:text-sm",children:Array.from({length:15},(s,c)=>{const r=new Date().getFullYear()+c;return e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>{const[,u]=o.split("-");y(`${r}-${u||""}`),v(!1)},className:"w-full text-left px-3 py-2 hover:bg-primary-purple/5",children:r})},r)})})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[11px] text-primary-blue font-semibold mb-2",children:["CVV ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary-purple/80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[e.jsx("path",{d:"M12 2l7 4v6c0 5-3.5 9-7 10-3.5-1-7-5-7-10V6l7-4z"}),e.jsx("path",{d:"M12 11v4"}),e.jsx("circle",{cx:"12",cy:"9",r:"1"})]})}),e.jsx("input",{inputMode:"numeric",placeholder:"CVV",value:i,onChange:s=>D(s.target.value),maxLength:4,className:"w-full pl-12 pr-4 py-4 rounded-full bg-white border border-gray-200 text-xs md:text-sm text-gray-800 placeholder-gray-400 outline-none"})]})]})]}),e.jsx(F,{text:"Save & Continue",onClick:P,loading:b,disabled:b})]})})]}),e.jsx(W,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})]})};export{J as default};
