import{r as a,j as t,S}from"./index-DyNF0vFl.js";import{P as B}from"./Pagination-Bhhi00xX.js";const M="/api",E=()=>localStorage.getItem("accessToken"),L=e=>({id:String(e.id),text:[e.title,e.message].filter(Boolean).join(" — ")||"Notification",timeISO:e.created_at||new Date().toISOString()}),A=e=>{try{return new Date(e).toLocaleString([],{hour:"2-digit",minute:"2-digit",year:"numeric",month:"short",day:"2-digit"})}catch{return e}},z=e=>String(e?.event_type||"").toLowerCase().includes("referral"),D=()=>{const[e,h]=a.useState([]),[c,v]=a.useState(1),[o]=a.useState(50),[l,u]=a.useState(0),[k,f]=a.useState(!1),[d,y]=a.useState(!0),[m,p]=a.useState(null),C=a.useMemo(()=>Math.max(1,Math.ceil(l/o)),[l,o]),j=async s=>{const w=E();if(!w){p("Not authenticated"),y(!1);return}f(!0),p(null);try{const r=(M||"").trim(),I=`${/^https?:\/\//i.test(r)?r.replace(/\/+$/,""):(window.location.origin+"/"+r.replace(/^\/+/,"")).replace(/\/+$/,"")}/notifications/?page=${encodeURIComponent(String(s))}&page_size=${encodeURIComponent(String(o))}`,n=await fetch(I,{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${w}`}}),P=n.headers.get("content-type")||"",b=async()=>{if(P.includes("application/json"))try{return await n.json()}catch{}try{return await n.text()}catch{return null}};if(!n.ok){const i=await b(),$=i&&typeof i=="object"&&(i.error||i.detail||i.message)||typeof i=="string"&&i||n.statusText||"Request failed";throw new Error(`HTTP ${n.status} ${$}`)}const g=await b(),x=g&&typeof g=="object"?g:{notifications:[],pagination:{}},N=(Array.isArray(x.notifications)?x.notifications:[]).filter(z).map(L);h(N);const T=N.length;u(Number(x.pagination?.total_count)||T),v(Number(x.pagination?.page)||s)}catch(r){p(r?.message||"Failed to load notifications"),h([]),u(0)}finally{f(!1),y(!1)}},R=s=>{if(s!==c){j(s);try{document.querySelector("#notifications-root")?.scrollIntoView({behavior:"smooth"})}catch{}}};return a.useEffect(()=>{j(1)},[]),t.jsxs("div",{id:"notifications-root",className:"sm:p-6 p-3",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsx("h2",{className:"md:text-2xl text-xl font-semibold text-primary-blue sm:pb-4 pb-0",children:"Notifications"})}),t.jsxs("div",{className:"mt-4 bg-white rounded-2xl shadow-sm border border-black/5 p-4 sm:p-5",children:[d&&t.jsx("div",{className:"py-10 flex items-center justify-center",children:t.jsx(S,{})}),!d&&m&&t.jsx("div",{className:"px-2 py-3 text-sm text-red-600",children:m}),!d&&!m&&e.length===0&&t.jsx("div",{className:"px-2 py-3 text-sm text-gray-500",children:"No notifications found."}),!d&&!m&&e.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("ul",{className:"space-y-3",children:e.map(s=>t.jsxs("li",{className:"bg-white rounded-2xl border border-gray-200 px-4 py-3 sm:py-4 flex items-center gap-3",children:[t.jsx("span",{className:"h-9 w-9 rounded-xl bg-primary-purple/10 text-primary-purple grid place-items-center shrink-0",children:t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",children:[t.jsx("rect",{x:"6",y:"4",width:"12",height:"16",rx:"2"}),t.jsx("path",{d:"M8 8h8M8 12h8M8 16h5"})]})}),t.jsx("div",{className:"flex-1",children:t.jsx("p",{className:"md:text-sm text-xs text-primary-blue leading-snug",children:s.text})}),t.jsx("div",{className:"sm:text-xs text-[10px] text-gray-400 shrink-0",children:A(s.timeISO)})]},s.id))}),t.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[t.jsxs("span",{className:"text-xs text-gray-500",children:["Showing ",(c-1)*o+1,"–",Math.min(c*o,l)," of ",l]}),t.jsx(B,{current:c,totalPages:C,onChange:R})]}),k&&t.jsx("div",{className:"mt-4 flex items-center justify-center",children:t.jsx(S,{})})]})]})]})};export{D as default};
