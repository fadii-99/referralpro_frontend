import{f as ie,r as a,j as e,i as Ee,v as Fe,k as Oe,m as ce,w as Ie,x as oe,y as M,z as Le,A as Ae,B as Te,S as Me,C as Be}from"./index-DTpFSV9c.js";import{B as de}from"./Button-P67AeVbE.js";import{L as $e,y as x}from"./ReactToastify-Bxb90Md6.js";import{c as Ue,I as le}from"./Category-DBMhr-0u.js";import{p as ne,g as Re,b as We,r as De,a as Ve}from"./metadata.max.json-CsV9usw-.js";const Ze=De,Ye="/api",Ge=["1 – 50","51 – 100","100 – 500","500+"],He=["Sole Proprietorship","Partnership","Corporation","LLC","Nonprofit","Other"],me={"Sole Proprietorship":"sole_proprietorship",Partnership:"partnership",Corporation:"corporation",LLC:"llc",Nonprofit:"nonprofit",Other:"other"},qe=Object.fromEntries(Object.entries(me).map(([s,o])=>[o,s])),Je=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],_=Re().map(s=>({code:s,dialCode:`+${Ve(s)}`,name:new Intl.DisplayNames(["en"],{type:"region"}).of(s)||s})).sort((s,o)=>s.name.localeCompare(o.name)),Ke=({open:s,onClose:o})=>{const{user:t,loadUser:i}=ie(),[n,m]=a.useState(t?.name||""),[r,p]=a.useState(t?.avatar||""),[c,$]=a.useState(null),[g,U]=a.useState("US"),[R,W]=a.useState(""),[pe,ue]=a.useState(!1),[j,D]=a.useState(t?.company_name||""),[E,V]=a.useState(t?.address1||""),[F,Z]=a.useState(t?.address2||""),[w,Y]=a.useState(t?.city||""),[O,G]=a.useState(t?.us_state||""),[N,H]=a.useState(t?.post_code||""),[v,q]=a.useState(t?.website||""),[I,J]=a.useState(t?.industry||""),[L,K]=a.useState(t?.employees||""),[X,Q]=a.useState(t?.biz_type||""),[xe,he]=a.useState(!1),[fe,ye]=a.useState(!1),[be,ge]=a.useState(!1),[je,we]=a.useState(!1),[A,Ne]=a.useState(""),ee=a.useRef(null),[te,T]=a.useState(!1),ve=Array.from(new Map(Ue.flatMap(l=>l.subcategories.map(f=>({subcategory:f.trim(),icon:l.icon}))).map(l=>[l.subcategory.toLowerCase(),l])).values()).sort((l,f)=>l.subcategory.localeCompare(f.subcategory)),se=l=>l.trim().toLowerCase().replace(/–/g,"-"),Ce=ve.filter(l=>A?se(l.subcategory).startsWith(se(A)):!0);if(a.useEffect(()=>{if(s&&(m(t?.name||""),p(t?.avatar||""),$(null),D(t?.company_name||""),V(t?.address1||""),Z(t?.address2||""),Y(t?.city||""),G(t?.us_state||""),H(t?.post_code||""),q(t?.website||""),J(t?.industry||""),K(t?.employees||""),Q(t?.biz_type?qe[t.biz_type]||t.biz_type:""),t?.phone)){const l=ne(t.phone);l&&(U(l.country||"US"),W(l.nationalNumber.toString()))}},[s,t]),!s)return null;const Se=()=>ee.current?.click(),ke=l=>{const f=l.target.files?.[0];f&&($(f),p(URL.createObjectURL(f)))},Pe=async()=>{if(!n.trim()){x.error("Name is required!");return}if(!/^[A-Za-z ]+$/.test(n.trim())){x.error("Full Name should only contain letters and spaces.");return}if(j.trim()&&!/^[A-Za-z ]+$/.test(j.trim())){x.error("Company Name should only contain letters and spaces (no numbers allowed).");return}const ze=`${_.find(u=>u.code===g)?.dialCode||""}${R}`,S=ne(ze);let k=null;try{const u=We(g,Ze);u&&(k=u.nationalNumber.toString().length)}catch{k=null}if(!S||!S.isValid()){let h=`Phone number for ${_.find(y=>y.code===g)?.name||g} must be valid.`;k&&(h+=` Expected ${k} digits.`),x.error(h);return}if(N&&!/^[0-9]+$/.test(N.trim())){x.error("Post Code must be numeric.");return}if(w&&!/^[A-Za-z ]+$/.test(w.trim())){x.error("City name must contain only letters and spaces.");return}if(v.trim()&&!/^www\.[^\s]+\.(com|org|net|edu|gov|mil|info|biz|xyz|online|io|ai|tech|app|dev)(\.[a-z]{2,3})?$/i.test(v.trim())){x.error("Invalid website. Example: www.example.com");return}T(!0);try{const u=localStorage.getItem("accessToken"),h=new FormData;n.trim()!==t?.name&&h.append("full_name",n.trim()),S.number!==t?.phone&&h.append("phone",S.number),c&&h.append("image",c);const y=X.trim(),P=y&&me[y]||(y?y.toLowerCase().replace(/\s+/g,"_").replace(/–/g,"-").replace(/-/g,"_"):"");y&&console.log("[edit-profile] bizType (UI) -> normalized:",y,"->",P);const d={};j.trim()!==t?.company_name&&(d.company_name=j.trim()),E.trim()!==t?.address1&&(d.address1=E.trim()),F.trim()!==t?.address2&&(d.address2=F.trim()),w.trim()!==t?.city&&(d.city=w.trim()),O.trim()!==t?.us_state&&(d.us_state=O.trim()),N.trim()!==t?.post_code&&(d.post_code=N.trim()),v.trim()!==t?.website&&(d.website=v.trim()),I.trim()!==t?.industry&&(d.industry=I.trim()),L.trim()!==t?.employees&&(d.employees=L.trim()),P&&P!==t?.biz_type&&(d.biz_type=P),console.log("[edit-profile] businessPayload candidate:",d),Object.keys(d).length>0&&h.append("business_info",JSON.stringify(d));const ae={};for(const[_e,C]of h.entries())ae[_e]=C instanceof File?{name:C.name,size:C.size,type:C.type}:C;if(console.log("[edit-profile] FormData to backend:",ae),[...h.keys()].length===0){x.info("No changes made."),T(!1);return}const z=await fetch(`${Ye}/auth/update_user/`,{method:"POST",headers:{Authorization:u?`Bearer ${u}`:""},body:h}),re=await z.json();if(console.log("[edit-profile] fetch status:",z.status),console.log("[edit-profile] response body:",re),!z.ok){x.error(re?.error||`Failed (${z.status})`);return}x.success("Profile updated successfully!"),await i(),o()}catch(u){console.error("[update-user] error:",u),x.error("Network error while updating profile.")}finally{T(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/30 p-4",children:[e.jsxs("div",{className:"w-full max-w-2xl bg-white rounded-3xl shadow-xl relative",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 pt-6",children:[e.jsx("h3",{className:"text-2xl font-semibold text-primary-blue",children:"Edit Profile"}),e.jsx("button",{onClick:o,className:"h-8 w-8 rounded-full border grid place-items-center",children:e.jsx(Ee,{className:"text-primary-purple"})})]}),e.jsxs("div",{className:"px-6 mt-3 flex flex-col items-center",children:[e.jsx("img",{src:r,alt:"avatar",className:"h-24 w-24 rounded-full object-cover ring-2 ring-white shadow"}),e.jsxs("button",{type:"button",onClick:Se,className:"mt-2 px-3 py-2 rounded-full bg-secondary-blue text-white flex items-center gap-1 text-xs",children:[e.jsx(Fe,{})," Change Photo"]}),e.jsx("input",{ref:ee,type:"file",accept:"image/*",className:"hidden",onChange:ke})]}),e.jsxs("div",{className:"px-6 pb-6 pt-4 space-y-5 overflow-y-auto max-h-[70vh]",children:[e.jsx(b,{icon:e.jsx(Oe,{}),label:"Full Name",required:!0,value:n,onChange:m}),e.jsx(Qe,{country:g,setCountry:U,localPhone:R,setLocalPhone:W,openCountry:pe,setOpenCountry:ue}),e.jsx(b,{icon:e.jsx(ce,{}),label:"Email",value:t?.email||"",disabled:!0}),e.jsx("hr",{className:"my-4"}),e.jsx(b,{icon:e.jsx(Ie,{}),label:"Company Name",value:j,onChange:D}),e.jsx(b,{icon:e.jsx(oe,{}),label:"Address 1",value:E,onChange:V}),e.jsx(b,{icon:e.jsx(oe,{}),label:"Address 2",value:F,onChange:Z}),e.jsx(b,{icon:e.jsx(M,{}),label:"City",value:w,onChange:Y}),e.jsx(Xe,{label:"Industry",value:I,setValue:J,open:xe,setOpen:he,search:A,setSearch:Ne,filtered:Ce}),e.jsx(B,{label:"Employees",icon:e.jsx(Le,{}),open:fe,setOpen:ye,options:Ge,value:L,setValue:K}),e.jsx(B,{label:"Business Type",icon:e.jsx(Ae,{}),open:be,setOpen:ge,options:He,value:X,setValue:Q}),e.jsx(B,{label:"State",icon:e.jsx(M,{}),open:je,setOpen:we,options:Je,value:O,setValue:G}),e.jsx(b,{icon:e.jsx(M,{}),label:"Post Code",value:N,onChange:H}),e.jsx(b,{icon:e.jsx(Te,{}),label:"Website",value:v,onChange:q}),e.jsx(de,{text:te?"Updating...":"Update",fullWidth:!0,onClick:Pe,disabled:te})]})]}),e.jsx($e,{position:"top-right",autoClose:3e3,hideProgressBar:!0})]})},b=({icon:s,label:o,value:t,onChange:i,required:n,disabled:m})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium mb-2 text-primary-blue",children:[o," ",n&&e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-5 top-1/2 -translate-y-1/2 text-primary-purple",children:s}),e.jsx("input",{type:"text",value:t,onChange:r=>i?.(r.target.value),disabled:m,className:`w-full pl-12 pr-4 py-3 rounded-full border text-sm ${m?"bg-gray-50 text-gray-500":"bg-white"}`})]})]}),B=({label:s,icon:o,open:t,setOpen:i,options:n,value:m,setValue:r})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-2 text-primary-blue",children:s}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-5 top-1/2 -translate-y-1/2 text-primary-purple",children:o}),e.jsx("button",{type:"button",onClick:()=>i(p=>!p),className:"w-full pl-12 pr-10 py-3 rounded-full border bg-white text-sm text-gray-800 text-left",children:m||`Select ${s}`}),t&&e.jsx("ul",{className:"absolute z-40 mt-1 w-full bg-white border rounded-2xl shadow-lg max-h-44 overflow-auto text-sm",children:n.map(p=>e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>{r(p),i(!1)},className:"w-full text-left px-4 py-2 hover:bg-primary-purple/10",children:p})},p))})]})]}),Xe=({label:s,value:o,setValue:t,open:i,setOpen:n,search:m,setSearch:r,filtered:p})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-2 text-primary-blue",children:s}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-5 top-1/2 -translate-y-1/2",children:e.jsx("img",{src:o?p.find(c=>c.subcategory===o)?.icon||le:le,alt:"",className:"h-5 w-5"})}),e.jsx("button",{type:"button",onClick:()=>n(c=>!c),className:"w-full pl-12 pr-10 py-3 rounded-full border bg-white text-sm text-gray-800 text-left",children:o||`Select ${s}`}),i&&e.jsxs("div",{className:"absolute z-40 mt-1 w-full bg-white border rounded-2xl shadow-lg max-h-56 overflow-auto text-sm",children:[e.jsx("div",{className:"sticky top-0 bg-white border-b p-2",children:e.jsx("input",{type:"text",value:m,onChange:c=>r(c.target.value),placeholder:"Search...",className:"w-full px-3 py-2 rounded-full border text-sm"})}),e.jsx("ul",{children:p.length>0?p.map(c=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{t(c.subcategory),n(!1),r("")},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-primary-purple/10",children:[e.jsx("img",{src:c.icon,alt:"",className:"h-4 w-4"})," ",c.subcategory]})},c.subcategory)):e.jsx("li",{className:"px-4 py-2 text-gray-400",children:"No result"})})]})]})]}),Qe=({country:s,setCountry:o,localPhone:t,setLocalPhone:i,openCountry:n,setOpenCountry:m})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-2 text-primary-blue",children:"Phone"}),e.jsxs("div",{className:"relative flex",children:[e.jsxs("button",{type:"button",onClick:()=>m(r=>!r),className:"pl-3 pr-8 py-3 rounded-l-full bg-white border border-gray-200 text-sm text-gray-800 flex items-center",style:{minWidth:"100px"},children:[_.find(r=>r.code===s)?.dialCode||"+--",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`ml-6 h-3 w-3 text-gray-500 transition-transform ${n?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),e.jsx("input",{type:"tel",placeholder:"Enter Phone",value:t,onChange:r=>i(r.target.value.replace(/\D/g,"")),className:"flex-1 pl-4 pr-4 py-3 rounded-r-full bg-white border border-gray-200 text-sm text-gray-800 placeholder-gray-400 outline-none"}),n&&e.jsx("ul",{className:"absolute top-full left-0 mt-1 w-72 bg-white border border-gray-200 rounded-2xl shadow-lg max-h-52 overflow-auto text-sm z-50",children:_.map(r=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{o(r.code),m(!1)},className:"w-full flex justify-start gap-3 px-3 py-2 hover:bg-primary-purple/5",children:[e.jsx("span",{className:"font-semibold w-12",children:r.dialCode}),e.jsx("span",{children:r.name})]})},r.code))})]})]}),ot=()=>{const{user:s,loading:o}=ie(),[t,i]=a.useState(!1);return o?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(Me,{})}):s?e.jsxs("div",{className:"p-10",children:[e.jsx("div",{className:"bg-white rounded-2xl border border-black/5 shadow-sm sm:p-10 p-8 max-w-4xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 md:gap-6 items-center",children:[e.jsx("div",{className:"flex items-center md:justify-start justify-center md:border-r col-span-1 md:pr-4 md:mb-0 mb-8",children:s.avatar&&e.jsx("img",{src:s.avatar,alt:s.name,className:"h-40 w-40 rounded-full object-cover ring-2 ring-white shadow"})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-3xl font-semibold text-primary-blue",children:s.name}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center sm:gap-5 gap-3 sm:text-sm text-xs text-gray-500",children:[e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(ce,{className:"text-primary-purple"}),s.email]}),s.phone&&e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Be,{className:"text-primary-purple"}),s.phone]})]}),e.jsx("div",{className:"mt-10",children:e.jsx(de,{text:"Edit Profile",onClick:()=>i(!0),fullWidth:!1,mt:"mt-0",py:"py-2 sm:py-3"})})]})]})}),e.jsx(Ke,{open:t,onClose:()=>i(!1)})]}):e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Failed to load profile."})};export{ot as default};
