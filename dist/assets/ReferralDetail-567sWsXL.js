import{r,m as A,y as n,j as e,S as C,s as D,t as R,v as I,a as $}from"./index-D-ho5R0I.js";import{B as E}from"./Button-DQgPLd3p.js";/* empty css                      */const g="/api",P=()=>{const[s,b]=r.useState(null),[j,m]=r.useState(!1),{membersFromApi:x,loading:y}=A(),[a,N]=r.useState(null),[p,u]=r.useState(!1),[i,v]=r.useState("Accept"),[h,w]=r.useState(""),[S,f]=r.useState(!1),c=r.useCallback(async()=>{const t=localStorage.getItem("accessToken"),l=localStorage.getItem("selectedReferralId");try{m(!0);const o=await(await fetch(`${g}/refer/list_company_referral/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({referral_id:l})})).json(),k=Array.isArray(o.referrals)?o.referrals[0]:null;b(k)}catch{n.error("⚠️ Failed to load referral detail")}finally{m(!1)}},[]);r.useEffect(()=>{c()},[c]);const _=async()=>{if(s){if(!a&&i!=="Reject"){n.error("⚠️ Please select an employee before proceeding.");return}f(!0);try{const t=localStorage.getItem("accessToken"),l=await fetch(`${g}/refer/assign_rep/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify({referral_id:s.id,status:i,employee_id:i==="Reject"?null:a?.id,note:h||""})});if(!l.ok){const o=await l.text();n.error(`Failed: ${l.status} - ${o}`);return}const d=await l.json();n.success("✅ Status updated successfully!"),console.log("Status update response:",d),await c()}catch{n.error("Network error, please try again")}finally{f(!1)}}};return j||!s?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(C,{})}):e.jsxs("div",{className:"p-4 sm:p-6 flex flex-col min-h-screen space-y-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-primary-blue text-center sm:text-left",children:"Referral Details"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between bg-white rounded-xl sm:rounded-2xl shadow-sm border border-black/5 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col items-start gap-1 sm:gap-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Reference ID"}),e.jsxs("p",{className:"font-semibold text-primary-blue text-sm sm:text-base",children:["#",s.reference_id]})]}),e.jsxs("div",{className:"text-left sm:text-right mt-3 sm:mt-0 flex flex-col items-start sm:items-end",children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.date}),e.jsx("span",{className:"inline-flex items-center px-2 sm:px-3 py-1 rounded-lg text-xs font-medium text-amber-500 bg-amber-50 mt-2",children:s.status})]})]}),e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-black/5 p-4 sm:p-6",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-primary-blue mb-4",children:"Customer Info"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4",children:[e.jsx("img",{src:`https://ui-avatars.com/api/?name=${encodeURIComponent(s.referred_to_name||"User")}&background=E5E7EB&color=374151`,alt:s.referred_to_name,className:"h-10 w-10 sm:h-12 sm:w-12 rounded-full object-cover"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"font-medium text-primary-blue text-sm sm:text-base",children:s.referred_to_name}),e.jsxs("p",{className:"text-xs text-gray-600 flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-4 pb-2",children:[e.jsxs("span",{className:`flex items-center gap-1 ${s.privacy?"blur-sm select-none":""}`,children:[e.jsx(D,{className:"text-gray-500 text-sm"}),s.referred_to_email]}),e.jsxs("span",{className:`flex items-center gap-1 ${s.privacy?"blur-sm select-none":""}`,children:[e.jsx(R,{className:"text-gray-500"}),s.referred_to_phone]})]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Reason:"})," ",s.reason]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Notes:"})," ",s.notes]})]})]}),e.jsx("div",{children:e.jsx("span",{className:`inline-flex items-center px-2 sm:px-3 py-1 rounded-lg text-xs font-medium capitalize
                ${s.urgency?.toLowerCase()==="urgent"?"text-rose-500 bg-rose-50":s.urgency?.toLowerCase()==="normal"?"text-blue-500 bg-blue-50":"text-slate-500 bg-slate-50"}`,children:s.urgency})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6",children:[s.assigned_to_id?e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-black/5 p-4 sm:p-6 lg:col-span-2",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-primary-blue mb-4",children:"Assigned Info"}),e.jsxs("div",{className:"flex flex-col gap-4 mt-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Assigned To"}),e.jsx("p",{className:"text-sm sm:text-base font-semibold text-primary-blue",children:s.assigned_to_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Assigned Date"}),e.jsx("p",{className:"text-sm sm:text-base text-primary-blue font-semibold",children:s.assigned_at})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Notes"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-700",children:s.assigned_notes||"—"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-black/5 p-4 sm:p-6",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-primary-blue mb-4",children:"Assignment"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>u(!p),className:"w-full border border-gray-200 rounded-xl px-3 py-2 text-sm sm:text-base text-left focus:outline-none focus:ring-2 focus:ring-primary-purple flex justify-between items-center",children:[a?a.name:"Select Employee",e.jsx(I,{className:"text-gray-400"})]}),p&&e.jsx("div",{className:"absolute z-20 mt-2 w-full bg-white border border-gray-200 rounded-xl shadow-lg max-h-60 overflow-y-auto",children:y?e.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"Loading..."}):x.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No team members found"}):x.map(t=>e.jsxs("div",{onClick:()=>{N(t),u(!1)},className:"flex items-center gap-3 px-4 py-2 cursor-pointer hover:bg-gray-50",children:[e.jsx("img",{src:t.avatar,alt:t.name,className:"h-8 w-8 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-primary-blue",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t.email})]})]},t.id))})]}),a&&e.jsxs("div",{className:"mt-5 flex items-center gap-3 p-3 border border-gray-100 rounded-xl bg-gray-50",children:[e.jsx("img",{src:a.avatar,alt:a.name,className:"h-8 w-8 sm:h-10 sm:w-10 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-primary-blue",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:a.email})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"⚠️ Only one employee can be assigned."})]}),e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-black/5 p-4 sm:p-6",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-primary-blue mb-4",children:"Status Update"}),e.jsxs("select",{value:i,onChange:t=>v(t.target.value),className:"w-full border border-gray-200 rounded-xl px-3 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-primary-purple",children:[e.jsx("option",{children:"Accept"}),e.jsx("option",{children:"Reject"}),e.jsx("option",{children:"In Progress"})]}),e.jsx("h4",{className:"text-sm font-semibold text-primary-blue mt-5",children:"Note"}),e.jsx("textarea",{placeholder:"Write here...",value:h,onChange:t=>w(t.target.value),className:"w-full mt-2 border border-gray-200 rounded-xl px-3 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-primary-purple",rows:4}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(E,{text:S?"Submitting...":"Done",onClick:_,disabled:!a})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-black/5 p-4 sm:p-6",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-primary-blue mb-4",children:"Activity Log"}),e.jsxs("div",{className:"relative pl-6",children:[e.jsx("div",{className:"absolute left-[7px] top-0 bottom-0 w-px bg-gray-200"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute -left-[22px] top-1 h-3 w-3 rounded-full bg-emerald-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sep 07, 2025"}),e.jsxs("p",{className:"text-primary-blue font-medium text-sm",children:["Referral received from ",e.jsx("span",{className:"font-semibold",children:"Ali Kazmi"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"10:15 AM"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute -left-[22px] top-1 h-3 w-3 rounded-full bg-emerald-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sep 08, 2025"}),e.jsxs("p",{className:"text-primary-blue font-medium text-sm",children:["Assigned to ",e.jsx("span",{className:"font-semibold",children:"Usama Kamran"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"02:30 PM"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute -left-[22px] top-1 h-3 w-3 rounded-full bg-emerald-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sep 09, 2025"}),e.jsxs("p",{className:"text-primary-blue font-medium text-sm",children:["Follow-up updated by ",e.jsx("span",{className:"font-semibold",children:"Fawad"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"11:00 AM"})]})]})]})]})]}),e.jsx($,{position:"top-right",autoClose:3e3,hideProgressBar:!0})]})};export{P as default};
