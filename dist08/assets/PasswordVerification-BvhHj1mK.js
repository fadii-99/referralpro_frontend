import{r as m,u as $,a as L,R as V,j as n}from"./index-DEn7bWb-.js";import{S as A}from"./SideDesign-BG-6cNKF.js";import{B as M}from"./Button-nLvsIS1P.js";import{L as B,y as d}from"./ReactToastify-ZS9tMTxy.js";const C=85,E="/api",U=()=>{const[l,f]=m.useState(Array(6).fill("")),a=m.useRef([]),[g,x]=m.useState(!1),[p,h]=m.useState(!1),[u,y]=m.useState(C),R=$(),k=L().state?.email||"",w=m.useContext(V);if(!w)throw new Error("Wrap your app with <RegistrationProvider />");const{setTempToken:P}=w;m.useEffect(()=>{a.current[0]?.focus()},[]),m.useEffect(()=>{if(u<=0)return;const s=setInterval(()=>y(e=>e-1),1e3);return()=>clearInterval(s)},[u]);const v=s=>s.replace(/\D/g,""),D=()=>l.join(""),j=l.every(s=>s.length===1),I=(s,e)=>{const t=v(s);if(t.length===0){const i=[...l];i[e]="",f(i);return}const c=t.split(""),r=[...l];let o=e;for(let i=0;i<c.length&&o<6;i++,o++)r[o]=c[i];f(r);const N=r.findIndex(i=>i===""),S=N===-1?Math.min(o-1,5):Math.max(e+1,Math.min(N,5));a.current[S]?.focus(),a.current[S]?.select()},O=(s,e)=>{if(s.key==="Backspace"){if(l[e]){const t=[...l];t[e]="",f(t)}else e>0&&(a.current[e-1]?.focus(),a.current[e-1]?.select());return}s.key==="ArrowLeft"&&e>0&&(a.current[e-1]?.focus(),a.current[e-1]?.select()),s.key==="ArrowRight"&&e<5&&(a.current[e+1]?.focus(),a.current[e+1]?.select())},T=(s,e)=>{s.preventDefault();const t=v(s.clipboardData.getData("text")).slice(0,6-e);if(!t)return;const c=[...l];for(let o=0;o<t.length&&e+o<6;o++)c[e+o]=t[o];f(c);const r=Math.min(e+t.length-1,5);a.current[r]?.focus(),a.current[r]?.select()},b=async()=>{if(g)return;if(!j){d.error("Please enter the 6-digit code.");return}x(!0);const s=D(),e=new FormData;e.append("otp",s),e.append("email",localStorage.getItem("Email")||"");try{const t=await fetch(`${E}/auth/verify_otp/`,{method:"POST",body:e}),c=t.headers.get("content-type")||"";let r=null;if(c.includes("application/json"))try{r=await t.json()}catch{}else try{r=await t.text()}catch{}if(!t.ok){console.groupCollapsed(`❌ verify_otp failed ${t.status} ${t.statusText}`),console.groupEnd();const o=r&&(r.error||r.detail||r.message)||"Verification failed";d.error(o);return}r&&typeof r!="string"&&r.temp_token&&P(r.temp_token),localStorage.removeItem("Email"),R("/CreatePassword")}catch(t){console.error("Verify error:",t),d.error("Invalid or expired code. Please try again.")}finally{x(!1)}},_=async()=>{if(p||u>0)return;const s=k||localStorage.getItem("Email")||"";if(!s){d.error("Email missing. Go back and enter your email again.");return}h(!0);try{const e=new FormData;e.append("email",s);const t=await fetch(`${E}/auth/send_otp/`,{method:"POST",body:e}),c=t.headers.get("content-type")||"";let r=null;if(c.includes("application/json"))try{r=await t.json()}catch{}else try{r=await t.text()}catch{}if(!t.ok){console.groupCollapsed(`❌ resend_otp failed ${t.status} ${t.statusText}`),console.groupEnd();const o=r&&(r.error||r.detail||r.message)||"Resend failed";d.error(o);return}d.success(typeof r=="string"?"OTP sent":r?.message||"OTP sent"),f(Array(6).fill("")),a.current[0]?.focus(),y(C)}catch(e){console.error("Resend error:",e),d.error("Network error. Please try again.")}finally{h(!1)}};return n.jsxs("div",{className:"grid md:grid-cols-5 w-full min-h-screen",children:[n.jsx(A,{}),n.jsx("div",{className:"md:col-span-3 flex items-center justify-center px-4 sm:px-6 md:px-8 py-8",children:n.jsxs("div",{className:"w-full max-w-lg",children:[n.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-3 mb-6 sm:mb-8",children:[n.jsx("h1",{className:"text-primary-blue font-semibold sm:text-4xt text-3xl text-center leading-tight",children:"Enter your passcode"}),n.jsx("p",{className:"text-[11px] sm:text-xs md:text-sm text-gray-700 text-center",children:"We’ve sent the code to the email on your device"})]}),n.jsxs("form",{className:"flex flex-col gap-5 sm:gap-6",onSubmit:s=>{s.preventDefault(),b()},children:[n.jsx("div",{className:"flex flex-wrap items-center justify-center gap-2 sm:gap-3 md:gap-4",children:Array.from({length:6}).map((s,e)=>n.jsx("input",{ref:t=>{a.current[e]=t},type:"tel",inputMode:"numeric",pattern:"[0-9]*",autoComplete:"one-time-code",maxLength:1,value:l[e],onChange:t=>I(t.target.value,e),onKeyDown:t=>O(t,e),onPaste:t=>T(t,e),placeholder:"-",className:`w-10 h-12 sm:w-12 sm:h-12 md:w-14 md:h-14 lg:w-16 lg:h-16\r
                             text-center text-base sm:text-lg md:text-xl font-medium\r
                             rounded-2xl bg-white border border-gray-200 placeholder-gray-300\r
                             outline-none focus:ring-2 focus:ring-primary-blue/20 focus:border-primary-blue/50`},e))}),n.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2",children:[n.jsx("span",{className:"text-xs sm:text-sm font-medium text-primary-purple/80","aria-live":"polite",children:u>0?`Resend code in ${u} sec`:"You can resend the code now"}),n.jsx("button",{type:"button",onClick:_,disabled:u>0||p,className:`text-sm font-semibold underline-offset-2 transition ${u>0||p?"text-gray-400 cursor-not-allowed":"text-primary-purple hover:text-primary-purple/90"}`,children:p?"Resending...":"Resend"})]}),n.jsx(M,{text:g?"Verifying...":"Submit",onClick:()=>void b(),disabled:g||!j})]})]})}),n.jsx(B,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})]})};export{U as default};
