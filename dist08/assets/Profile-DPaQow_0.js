import{e as le,r as a,j as e,g as Pe,s as _e,h as Ee,k as ne,t as Fe,v as ze,w as Oe,x as se,y as T,z as Ie,S as Le,A as Ae}from"./index-DEn7bWb-.js";import{B as ie}from"./Button-nLvsIS1P.js";import{L as Me,y as x}from"./ReactToastify-ZS9tMTxy.js";import{c as Te,I as ae}from"./Category-DBMhr-0u.js";import{p as re,g as Be,b as $e,r as Ue,a as Re}from"./metadata.max.json-CsV9usw-.js";const We=Ue,Ve="/api",De=["1 – 50","51 – 100","100 – 500","500+"],Ye=["Sole Proprietorship","Partnership","Corporation","LLC","Nonprofit","Other"],oe={"Sole Proprietorship":"sole_proprietorship",Partnership:"partnership",Corporation:"corporation",LLC:"llc",Nonprofit:"nonprofit",Other:"other"},Ze=Object.fromEntries(Object.entries(oe).map(([s,l])=>[l,s])),Ge=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],k=Be().map(s=>({code:s,dialCode:`+${Re(s)}`,name:new Intl.DisplayNames(["en"],{type:"region"}).of(s)||s})).sort((s,l)=>s.name.localeCompare(l.name)),He=({open:s,onClose:l})=>{const{user:t,loadUser:o}=le(),[i,d]=a.useState(t?.name||""),[r,m]=a.useState(t?.avatar||""),[c,$]=a.useState(null),[g,U]=a.useState("US"),[R,W]=a.useState(""),[ce,de]=a.useState(!1),[P,V]=a.useState(t?.company_name||""),[_,D]=a.useState(t?.address1||""),[E,Y]=a.useState(t?.address2||""),[j,Z]=a.useState(t?.city||""),[F,G]=a.useState(t?.us_state||""),[w,H]=a.useState(t?.post_code||""),[N,q]=a.useState(t?.website||""),[z,J]=a.useState(t?.industry||""),[O,K]=a.useState(t?.employees||""),[v,X]=a.useState(t?.biz_type||""),[me,pe]=a.useState(!1),[ue,xe]=a.useState(!1),[he,fe]=a.useState(!1),[ye,be]=a.useState(!1),[I,ge]=a.useState(""),Q=a.useRef(null),[ee,L]=a.useState(!1),je=Array.from(new Map(Te.flatMap(n=>n.subcategories.map(f=>({subcategory:f.trim(),icon:n.icon}))).map(n=>[n.subcategory.toLowerCase(),n])).values()).sort((n,f)=>n.subcategory.localeCompare(f.subcategory)),te=n=>n.trim().toLowerCase().replace(/–/g,"-"),we=je.filter(n=>I?te(n.subcategory).startsWith(te(I)):!0);if(a.useEffect(()=>{if(s&&(d(t?.name||""),m(t?.avatar||""),$(null),V(t?.company_name||""),D(t?.address1||""),Y(t?.address2||""),Z(t?.city||""),G(t?.us_state||""),H(t?.post_code||""),q(t?.website||""),J(t?.industry||""),K(t?.employees||""),X(t?.biz_type?Ze[t.biz_type]||t.biz_type:""),t?.phone)){const n=re(t.phone);n&&(U(n.country||"US"),W(n.nationalNumber.toString()))}},[s,t]),!s)return null;const Ne=()=>Q.current?.click(),ve=n=>{const f=n.target.files?.[0];f&&($(f),m(URL.createObjectURL(f)))},Ce=async()=>{if(!i.trim()){x.error("Name is required!");return}if(!/^[A-Za-z ]+$/.test(i.trim())){x.error("Full Name should only contain letters and spaces.");return}const Se=`${k.find(u=>u.code===g)?.dialCode||""}${R}`,C=re(Se);let S=null;try{const u=$e(g,We);u&&(S=u.nationalNumber.toString().length)}catch{S=null}if(!C||!C.isValid()){let h=`Phone number for ${k.find(b=>b.code===g)?.name||g} must be valid.`;S&&(h+=` Expected ${S} digits.`),x.error(h);return}if(w&&!/^[0-9]+$/.test(w.trim())){x.error("Post Code must be numeric.");return}if(j&&!/^[A-Za-z ]+$/.test(j.trim())){x.error("City name must contain only letters and spaces.");return}if(N.trim()&&!/^www\.[^\s]+\.(com|org|net|edu|gov|mil|info|biz|xyz|online|io|ai|tech|app|dev)(\.[a-z]{2,3})?$/i.test(N.trim())){x.error("Invalid website. Example: www.example.com");return}L(!0);try{const u=localStorage.getItem("accessToken"),h=new FormData;i.trim()!==t?.name&&h.append("full_name",i.trim()),C.number!==t?.phone&&h.append("phone",C.number),c&&h.append("image",c);const b=v.trim(),A=b&&oe[b]||(b?b.toLowerCase().replace(/\s+/g,"_").replace(/–/g,"-").replace(/-/g,"_"):""),p={};if(v!=="sole"&&(P.trim()!==t?.company_name&&(p.company_name=P.trim()),O.trim()!==t?.employees&&(p.employees=O.trim()),A&&A!==t?.biz_type&&(p.biz_type=A)),_.trim()!==t?.address1&&(p.address1=_.trim()),E.trim()!==t?.address2&&(p.address2=E.trim()),j.trim()!==t?.city&&(p.city=j.trim()),F.trim()!==t?.us_state&&(p.us_state=F.trim()),w.trim()!==t?.post_code&&(p.post_code=w.trim()),N.trim()!==t?.website&&(p.website=N.trim()),z.trim()!==t?.industry&&(p.industry=z.trim()),Object.keys(p).length>0&&h.append("business_info",JSON.stringify(p)),[...h.keys()].length===0){x.info("No changes made."),L(!1);return}const M=await fetch(`${Ve}/auth/update_user/`,{method:"POST",headers:{Authorization:u?`Bearer ${u}`:""},body:h}),ke=await M.json();if(!M.ok){x.error(ke?.error||`Failed (${M.status})`);return}x.success("Profile updated successfully!"),await o(),l()}catch{x.error("Network error while updating profile.")}finally{L(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/30 p-4",children:[e.jsxs("div",{className:"w-full max-w-2xl bg-white rounded-3xl shadow-xl relative",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 pt-6",children:[e.jsx("h3",{className:"text-2xl font-semibold text-primary-blue",children:"Edit Profile"}),e.jsx("button",{onClick:l,className:"h-8 w-8 rounded-full border grid place-items-center",children:e.jsx(Pe,{className:"text-primary-purple"})})]}),e.jsxs("div",{className:"px-6 mt-3 flex flex-col items-center",children:[e.jsx("img",{src:r,alt:"avatar",className:"h-24 w-24 rounded-full object-cover ring-2 ring-white shadow"}),e.jsxs("button",{type:"button",onClick:Ne,className:"mt-2 px-3 py-2 rounded-full bg-secondary-blue text-white flex items-center gap-1 text-xs",children:[e.jsx(_e,{})," Change Photo"]}),e.jsx("input",{ref:Q,type:"file",accept:"image/*",className:"hidden",onChange:ve})]}),e.jsxs("div",{className:"px-6 pb-6 pt-4 space-y-5 overflow-y-auto max-h-[70vh]",children:[e.jsx(y,{icon:e.jsx(Ee,{}),label:"Full Name",required:!0,value:i,onChange:d}),e.jsx(Je,{country:g,setCountry:U,localPhone:R,setLocalPhone:W,openCountry:ce,setOpenCountry:de}),e.jsx(y,{icon:e.jsx(ne,{}),label:"Email",value:t?.email||"",disabled:!0}),e.jsx("hr",{className:"my-4"}),v!=="sole"&&e.jsxs(e.Fragment,{children:[e.jsx(y,{icon:e.jsx(Fe,{}),label:"Company Name",value:P,onChange:V}),e.jsx(B,{label:"Employees",icon:e.jsx(ze,{}),open:ue,setOpen:xe,options:De,value:O,setValue:K}),e.jsx(B,{label:"Business Type",icon:e.jsx(Oe,{}),open:he,setOpen:fe,options:Ye,value:v,setValue:X})]}),e.jsx(y,{icon:e.jsx(se,{}),label:"Address 1",value:_,onChange:D}),e.jsx(y,{icon:e.jsx(se,{}),label:"Address 2",value:E,onChange:Y}),e.jsx(y,{icon:e.jsx(T,{}),label:"City",value:j,onChange:Z}),e.jsx(qe,{label:"Industry",value:z,setValue:J,open:me,setOpen:pe,search:I,setSearch:ge,filtered:we}),e.jsx(B,{label:"State",icon:e.jsx(T,{}),open:ye,setOpen:be,options:Ge,value:F,setValue:G}),e.jsx(y,{icon:e.jsx(T,{}),label:"Post Code",value:w,onChange:H}),e.jsx(y,{icon:e.jsx(Ie,{}),label:"Website",value:N,onChange:q}),e.jsx(ie,{text:ee?"Updating...":"Update",fullWidth:!0,onClick:Ce,disabled:ee})]})]}),e.jsx(Me,{position:"top-right",autoClose:3e3,hideProgressBar:!0})]})},y=({icon:s,label:l,value:t,onChange:o,required:i,disabled:d})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium mb-2 text-primary-blue",children:[l," ",i&&e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-5 top-1/2 -translate-y-1/2 text-primary-purple",children:s}),e.jsx("input",{type:"text",value:t,onChange:r=>o?.(r.target.value),disabled:d,className:`w-full pl-12 pr-4 py-3 rounded-full border text-sm ${d?"bg-gray-50 text-gray-500":"bg-white"}`})]})]}),B=({label:s,icon:l,open:t,setOpen:o,options:i,value:d,setValue:r})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-2 text-primary-blue",children:s}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-5 top-1/2 -translate-y-1/2 text-primary-purple",children:l}),e.jsx("button",{type:"button",onClick:()=>o(m=>!m),className:"w-full pl-12 pr-10 py-3 rounded-full border bg-white text-sm text-gray-800 text-left",children:d||`Select ${s}`}),t&&e.jsx("ul",{className:"absolute z-40 mt-1 w-full bg-white border rounded-2xl shadow-lg max-h-44 overflow-auto text-sm",children:i.map(m=>e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>{r(m),o(!1)},className:"w-full text-left px-4 py-2 hover:bg-primary-purple/10",children:m})},m))})]})]}),qe=({label:s,value:l,setValue:t,open:o,setOpen:i,search:d,setSearch:r,filtered:m})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-2 text-primary-blue",children:s}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-5 top-1/2 -translate-y-1/2",children:e.jsx("img",{src:l?m.find(c=>c.subcategory===l)?.icon||ae:ae,alt:"",className:"h-5 w-5"})}),e.jsx("button",{type:"button",onClick:()=>i(c=>!c),className:"w-full pl-12 pr-10 py-3 rounded-full border bg-white text-sm text-gray-800 text-left",children:l||`Select ${s}`}),o&&e.jsxs("div",{className:"absolute z-40 mt-1 w-full bg-white border rounded-2xl shadow-lg max-h-56 overflow-auto text-sm",children:[e.jsx("div",{className:"sticky top-0 bg-white border-b p-2",children:e.jsx("input",{type:"text",value:d,onChange:c=>r(c.target.value),placeholder:"Search...",className:"w-full px-3 py-2 rounded-full border text-sm"})}),e.jsx("ul",{children:m.length>0?m.map(c=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{t(c.subcategory),i(!1),r("")},className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-primary-purple/10",children:[e.jsx("img",{src:c.icon,alt:"",className:"h-4 w-4"})," ",c.subcategory]})},c.subcategory)):e.jsx("li",{className:"px-4 py-2 text-gray-400",children:"No result"})})]})]})]}),Je=({country:s,setCountry:l,localPhone:t,setLocalPhone:o,openCountry:i,setOpenCountry:d})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-2 text-primary-blue",children:"Phone"}),e.jsxs("div",{className:"relative flex",children:[e.jsxs("button",{type:"button",onClick:()=>d(r=>!r),className:"pl-3 pr-8 py-3 rounded-l-full bg-white border border-gray-200 text-sm text-gray-800 flex items-center",style:{minWidth:"100px"},children:[k.find(r=>r.code===s)?.dialCode||"+--",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`ml-6 h-3 w-3 text-gray-500 transition-transform ${i?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),e.jsx("input",{type:"tel",placeholder:"Enter Phone",value:t,onChange:r=>o(r.target.value.replace(/\D/g,"")),className:"flex-1 pl-4 pr-4 py-3 rounded-r-full bg-white border border-gray-200 text-sm text-gray-800 placeholder-gray-400 outline-none"}),i&&e.jsx("ul",{className:"absolute top-full left-0 mt-1 w-72 bg-white border border-gray-200 rounded-2xl shadow-lg max-h-52 overflow-auto text-sm z-50",children:k.map(r=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{l(r.code),d(!1)},className:"w-full flex justify-start gap-3 px-3 py-2 hover:bg-primary-purple/5",children:[e.jsx("span",{className:"font-semibold w-12",children:r.dialCode}),e.jsx("span",{children:r.name})]})},r.code))})]})]}),st=()=>{const{user:s,loading:l}=le(),[t,o]=a.useState(!1);return l?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(Le,{})}):s?e.jsxs("div",{className:"p-10",children:[e.jsx("div",{className:"bg-white rounded-2xl border border-black/5 shadow-sm sm:p-10 p-8 max-w-4xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 md:gap-6 items-center",children:[e.jsx("div",{className:"flex items-center md:justify-start justify-center md:border-r col-span-1 md:pr-4 md:mb-0 mb-8",children:s.avatar&&e.jsx("img",{src:s.avatar,alt:s.name,className:"h-40 w-40 rounded-full object-cover ring-2 ring-white shadow"})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-3xl font-semibold text-primary-blue",children:s.name}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center sm:gap-5 gap-3 sm:text-sm text-xs text-gray-500",children:[e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(ne,{className:"text-primary-purple"}),s.email]}),s.phone&&e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Ae,{className:"text-primary-purple"}),s.phone]})]}),e.jsx("div",{className:"mt-10",children:e.jsx(ie,{text:"Edit Profile",onClick:()=>o(!0),fullWidth:!1,mt:"mt-0",py:"py-2 sm:py-3"})})]})]})}),e.jsx(He,{open:t,onClose:()=>o(!1)})]}):e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Failed to load profile."})};export{st as default};
