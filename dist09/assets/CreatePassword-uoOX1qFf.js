import{u as v,r as n,R as C,j as e}from"./index-CGjmr3OW.js";import{S as P}from"./SideDesign-BF3NaLyw.js";import{B as k}from"./Button-vl0ONvB8.js";import{l as w,A as x,a as f}from"./index-D7qHDGDI.js";import{L as S,y as o}from"./ReactToastify-Dj0MA1Xw.js";const E="/api",T=()=>{const h=v(),d=n.useContext(C);if(!d)throw new Error("Wrap your app with <RegistrationProvider />");const{tempToken:y,setTempToken:g}=d,[t,b]=n.useState({password:"",confirmPassword:""}),[l,p]=n.useState({pwd:!1,cpwd:!1}),[i,m]=n.useState(!1),u=r=>{const{name:a,value:c}=r.target;b(s=>({...s,[a]:c}))},j=async()=>{if(i)return;if(!t.password||!t.confirmPassword){o.error("Please fill both password fields.");return}if(t.password.length<8){o.error("Password must be at least 8 characters.");return}if(t.password!==t.confirmPassword){o.error("Passwords do not match.");return}m(!0);const r=new FormData;r.append("new_password",t.password),r.append("temp_token",y);try{const a=await fetch(`${E}/auth/reset_password/`,{method:"POST",body:r});if(a.status===429||a.status===502||a.status===503){o.error("Server is busy, please try again.");return}const c=a.headers.get("content-type")||"";let s=null;if(c.includes("application/json"))try{s=await a.json()}catch{}else try{s=await a.text()}catch{}if(!a.ok){const N=s&&typeof s!="string"&&(s.error||s.detail||s.message)||(typeof s=="string"?s:"Could not set password");o.error(N);return}o.success(typeof s=="string"?"Password set successfully":s?.message||"Password set successfully"),g(""),h("/PasswordSuccess")}catch(a){console.error("Create password error:",a),o.error("Network error. Please try again.")}finally{m(!1)}};return e.jsxs("div",{className:"grid md:grid-cols-5 w-full min-h-screen",children:[e.jsx(P,{}),e.jsx("div",{className:"md:col-span-3 flex items-center justify-center px-4",children:e.jsxs("div",{className:"w-full max-w-lg",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 mb-8",children:[e.jsx("h1",{className:"text-primary-blue font-semibold sm:text-4xl text-3xl",children:"Create new password"}),e.jsx("p",{className:"text-[11px] sm:text-xs md:text-sm text-center",children:"Use a new password you haven't used before."})]}),e.jsxs("form",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{htmlFor:"password",className:"block text-xs text-primary-blue font-medium mb-2",children:["Password",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-8 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsx("img",{src:w,alt:"password",className:"h-5 w-5"})}),e.jsx("button",{type:"button",tabIndex:-1,"aria-label":l.pwd?"Hide password":"Show password",onClick:()=>p(r=>({...r,pwd:!r.pwd})),className:"absolute right-4 top-1/2 -translate-y-1/2 p-1 text-primary-purple hover:opacity-90 transition",children:l.pwd?e.jsx(x,{className:"h-5 w-5"}):e.jsx(f,{className:"h-5 w-5"})}),e.jsx("input",{id:"password",name:"password",type:l.pwd?"text":"password",required:!0,placeholder:"Enter your password",value:t.password,onChange:u,autoComplete:"new-password",autoCapitalize:"none",autoCorrect:"off",spellCheck:!1,className:"w-full pl-16 pr-12 py-5 rounded-full bg-white border border-gray-200 text-xs outline-none text-gray-800 placeholder-gray-400 focus:ring-2 focus:ring-primary-blue/20 focus:border-primary-blue/50"})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("label",{htmlFor:"confirmPassword",className:"block text-xs text-primary-blue font-medium mb-2",children:["Confirm Password",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-8 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsx("img",{src:w,alt:"confirm password",className:"h-5 w-5"})}),e.jsx("button",{type:"button",tabIndex:-1,"aria-label":l.cpwd?"Hide confirm password":"Show confirm password",onClick:()=>p(r=>({...r,cpwd:!r.cpwd})),className:"absolute right-4 top-1/2 -translate-y-1/2 p-1 text-primary-purple hover:opacity-90 transition",children:l.cpwd?e.jsx(x,{className:"h-5 w-5"}):e.jsx(f,{className:"h-5 w-5"})}),e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:l.cpwd?"text":"password",required:!0,placeholder:"Enter Confirm Password",value:t.confirmPassword,onChange:u,autoComplete:"new-password",autoCapitalize:"none",autoCorrect:"off",spellCheck:!1,className:"w-full pl-16 pr-12 py-5 rounded-full bg-white border border-gray-200 text-xs outline-none text-gray-800 placeholder-gray-400 focus:ring-2 focus:ring-primary-blue/20 focus:border-primary-blue/50"})]})]}),e.jsx(k,{text:i?"Saving...":"Confirm",onClick:j,disabled:i})]})]})}),e.jsx(S,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})]})};export{T as default};
