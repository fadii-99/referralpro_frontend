import{u as z,r as l,R as E,j as e}from"./index-Zh5oL39c.js";import{S as F}from"./SideDesign-CCHUTGou.js";import{B as I}from"./Button-vU8xAsm_.js";import{M as W}from"./MultiStepHeader-B5h5kQBQ.js";import{L,y as o}from"./ReactToastify-wgTiCQ29.js";const R="/api",x=a=>a.replace(/\D/g,""),A=a=>x(a).slice(0,16).replace(/(\d{4})(?=\d)/g,"$1 ").trim(),H=a=>{if(!/^\d{4}-\d{2}$/.test(a))return"";const[d,t]=a.split("-");return`${t}/${d.slice(-2)}`},J=()=>{const a=z(),d=l.useContext(E);if(!d)throw new Error("Wrap your app with <RegistrationProvider /> first.");const{registrationData:t,finishSignup:k}=d,[h,v]=l.useState(""),[u,w]=l.useState(""),[n,g]=l.useState(""),[i,j]=l.useState(""),[y,N]=l.useState(!1),[M,b]=l.useState(!1),[T,f]=l.useState(!1),V=l.useMemo(()=>x(u).length,[u]),P=s=>w(A(s)),Y=s=>j(x(s).slice(0,4)),D=async()=>{if(y)return;if(!h.trim()||!u.trim()||!n||!i.trim()){o.error("Please fill out card name, number, expiry and CVV.");return}if(V!==16){o.error("Card number must be 16 digits.");return}if(i.length<3||i.length>4){o.error(i.length<3?"CVV is too short (3–4 digits required).":"CVV is too long (3–4 digits required).");return}const[s,c]=n.split("-");if(!s||s==="0000"){o.error("Please select expiry year.");return}if(!c||c==="00"){o.error("Please select expiry month.");return}N(!0);try{const r=t.profileType==="company",m=H(n),$={welcome:{role:"Business",profileType:t.profileType||""},basic:{firstName:t.firstName,lastName:t.lastName,industry:t.industry,email:t.email,...r?{companyName:t.companyName}:{}},businessType:{type:r?t.bizType:"sole",years:t.years,employees:t.employees,usState:t.usState},companyInfo:{address1:t.address1,address2:t.address2,city:t.city,postCode:t.postCode,phone:t.phone,website:t.website},subscription:{billing:t.subscriptionBilling,planId:t.subscriptionPlanId===null?null:Number(t.subscriptionPlanId),seats:Number(t.subscriptionSeats),currency:t.subscriptionCurrency||"USD",total:Number(t.subscriptionTotal||0),totalDisplay:t.subscriptionTotalDisplay||""},payment:{paymentType:t.paymentType,charge:{currency:t.subscriptionCurrency||"USD",total:Number(t.subscriptionTotal||0),totalDisplay:t.subscriptionTotalDisplay||""},card:{name:h.trim(),number:x(u),expiry:{monthValue:n,mmYY:m},cvv:i}},password:{value:t.password||""}},C=new FormData;C.append("payload",JSON.stringify($));const S=await fetch(`${R}/auth/sign_up/`,{method:"POST",body:C}),p=await S.json();if(console.log("Getting data from signup success",p),!S.ok){const O=p.error||p.detail||p.message||"Payment submit failed";o.error(O);return}p?.tokens?.access&&localStorage.setItem("accessToken",p.tokens.access),o.success("Signup successful!"),setTimeout(()=>{k({clear:!0}),v(""),w(""),g(""),j(""),a("/Dashboard",{replace:!0})},1e3)}catch(r){console.error(r),o.error("Something went wrong. Try again.")}finally{N(!1)}},B=t.paymentType==="stripe";return e.jsxs("div",{className:"grid md:grid-cols-5 w-full min-h-screen",children:[e.jsx(F,{}),e.jsxs("div",{className:"md:col-span-3 flex flex-col bg-[#F4F2FA]",children:[e.jsx("div",{className:"sticky top-5 z-30 backdrop-blur w-full max-w-lg mx-auto",children:e.jsx("div",{className:"px-4",children:e.jsx(W,{title:"Payment Method",current:6,total:6,onBack:()=>a(-1)})})}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-4",children:e.jsxs("div",{className:"w-full max-w-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[11px] text-primary-blue font-semibold mb-2",children:["Card Name ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary-purple/80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[e.jsx("path",{d:"M12 12a4 4 0 100-8 4 4 0 000 8Z"}),e.jsx("path",{d:"M3 20a9 9 0 0118 0"})]})}),e.jsx("input",{type:"text",placeholder:"Card Name",value:h,onChange:s=>v(s.target.value),className:"w-full pl-12 pr-4 py-4 rounded-full bg-white border border-gray-200 text-xs md:text-sm text-gray-800 placeholder-gray-400 outline-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[11px] text-primary-blue font-semibold mb-2",children:["Card Number ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary-purple/80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[e.jsx("rect",{x:"3",y:"5",width:"18",height:"14",rx:"2"}),e.jsx("path",{d:"M3 10h18"})]})}),e.jsx("input",{inputMode:"numeric",maxLength:19,placeholder:"0000 0000 0000 0000",value:u,onChange:s=>P(s.target.value),className:"w-full pl-12 pr-4 py-4 rounded-full bg-white border border-gray-200 text-xs md:text-sm text-gray-800 placeholder-gray-400 outline-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[11px] text-primary-blue font-semibold mb-2",children:["Expiry ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"relative flex items-center gap-2",children:[e.jsx("span",{className:"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 z-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary-purple/80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:e.jsx("path",{d:"M7 4v3M17 4v3M4 9h16M5 20h14a2 2 0 0 0 2-2v-9H3v9a2 2 0 0 0 2 2Z"})})}),e.jsxs("div",{className:"relative w-1/2",children:[e.jsx("button",{type:"button",onClick:()=>{b(s=>!s),f(!1)},className:"w-full pl-12 pr-8 py-4 rounded-full bg-white border border-gray-200 text-left text-xs md:text-sm text-gray-800 outline-none",children:n.split("-")[1]||"MM"}),M&&e.jsx("ul",{className:"absolute z-40 mt-2 w-full bg-white border border-gray-200 rounded-2xl shadow-lg overflow-auto max-h-44 text-[11px] sm:text-sm",children:Array.from({length:12},(s,c)=>{const r=String(c+1).padStart(2,"0");return e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>{const[m]=n.split("-");g(`${m||""}-${r}`),b(!1)},className:"w-full text-left px-3 py-2 hover:bg-primary-purple/5",children:r})},r)})})]}),e.jsxs("div",{className:"relative w-1/2",children:[e.jsx("button",{type:"button",onClick:()=>{f(s=>!s),b(!1)},className:"w-full pl-4 pr-8 py-4 rounded-full bg-white border border-gray-200 text-left text-xs md:text-sm text-gray-800 outline-none",children:n.split("-")[0]||"YYYY"}),T&&e.jsx("ul",{className:"absolute z-40 mt-2 w-full bg-white border border-gray-200 rounded-2xl shadow-lg overflow-auto max-h-44 text-[11px] sm:text-sm",children:Array.from({length:15},(s,c)=>{const r=new Date().getFullYear()+c;return e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>{const[,m]=n.split("-");g(`${r}-${m||""}`),f(!1)},className:"w-full text-left px-3 py-2 hover:bg-primary-purple/5",children:r})},r)})})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[11px] text-primary-blue font-semibold mb-2",children:["CVV ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary-purple/80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[e.jsx("path",{d:"M12 2l7 4v6c0 5-3.5 9-7 10-3.5-1-7-5-7-10V6l7-4z"}),e.jsx("path",{d:"M12 11v4"}),e.jsx("circle",{cx:"12",cy:"9",r:"1"})]})}),e.jsx("input",{inputMode:"numeric",placeholder:"CVV",value:i,onChange:s=>Y(s.target.value),maxLength:4,className:"w-full pl-12 pr-4 py-4 rounded-full bg-white border border-gray-200 text-xs md:text-sm text-gray-800 placeholder-gray-400 outline-none"})]})]})]}),e.jsx("p",{className:"text-[11px] text-gray-500 text-center",children:B?"Payments secured by Stripe":"Bank transfer will be processed manually"}),e.jsx(I,{text:y?"Processing...":"Save & Continue",onClick:D,disabled:y}),e.jsx("p",{className:"mt-2 text-center text-[11px] text-gray-500",children:"Terms of Service | Privacy Policy"})]})})]}),e.jsx(L,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})]})};export{J as default};
