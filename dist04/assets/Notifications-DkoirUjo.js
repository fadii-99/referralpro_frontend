import{r as a,j as e,S as j}from"./index-BCafBE9j.js";import{P}from"./Pagination-BE1tO18r.js";const L="/api",M=()=>localStorage.getItem("accessToken"),R=t=>({id:String(t.id),text:[t.title,t.message].filter(Boolean).join(" — ")||"Notification",timeISO:t.created_at||new Date().toISOString()}),T=t=>{try{return new Date(t).toLocaleString([],{hour:"2-digit",minute:"2-digit",year:"numeric",month:"short",day:"2-digit"})}catch{return t}},C=t=>String(t?.event_type||"").toLowerCase().includes("referral"),z=()=>{const[t,h]=a.useState([]),[o,y]=a.useState(1),[i]=a.useState(50),[c,w]=a.useState(0),[S,g]=a.useState(!1),[l,p]=a.useState(!0),[d,x]=a.useState(null),N=a.useMemo(()=>Math.max(1,Math.ceil(c/i)),[c,i]),u=async s=>{const f=M();if(!f){x("Not authenticated"),p(!1);return}g(!0),x(null);try{const r=new URL(`${L.replace(/\/+$/,"")}/notifications/`);r.searchParams.set("page",String(s)),r.searchParams.set("page_size",String(i));const n=await fetch(r.toString(),{headers:{Accept:"application/json",Authorization:`Bearer ${f}`}});if(!n.ok){const k=await n.text();throw new Error(`HTTP ${n.status} ${k||n.statusText}`)}const m=await n.json(),v=(m.notifications||[]).filter(C).map(R);h(v),w(Number(m.pagination?.total_count)||0),y(m.pagination?.page||s)}catch(r){x(r?.message||"Failed to load notifications")}finally{g(!1),p(!1)}},b=s=>{if(s!==o){u(s);try{document.querySelector("#notifications-root")?.scrollIntoView({behavior:"smooth"})}catch{}}};return a.useEffect(()=>{u(1)},[]),e.jsxs("div",{id:"notifications-root",className:"sm:p-6 p-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"md:text-2xl text-xl font-semibold text-primary-blue sm:pb-4 pb-0",children:"Notifications"})}),e.jsxs("div",{className:"mt-4 bg-white rounded-2xl shadow-sm border border-black/5 p-4 sm:p-5",children:[l&&e.jsx("div",{className:"py-10 flex items-center justify-center",children:e.jsx(j,{})}),!l&&d&&e.jsx("div",{className:"px-2 py-3 text-sm text-red-600",children:d}),!l&&!d&&t.length===0&&e.jsx("div",{className:"px-2 py-3 text-sm text-gray-500",children:"No notifications found."}),!l&&!d&&t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-3",children:t.map(s=>e.jsxs("li",{className:"bg-white rounded-2xl border border-gray-200 px-4 py-3 sm:py-4 flex items-center gap-3",children:[e.jsx("span",{className:"h-9 w-9 rounded-xl bg-primary-purple/10 text-primary-purple grid place-items-center shrink-0",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",children:[e.jsx("rect",{x:"6",y:"4",width:"12",height:"16",rx:"2"}),e.jsx("path",{d:"M8 8h8M8 12h8M8 16h5"})]})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"md:text-sm text-xs text-primary-blue leading-snug",children:s.text})}),e.jsx("div",{className:"sm:text-xs text-[10px] text-gray-400 shrink-0",children:T(s.timeISO)})]},s.id))}),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["Showing ",(o-1)*i+1,"–",Math.min(o*i,c)," of ",c]}),e.jsx(P,{current:o,totalPages:N,onChange:b})]}),S&&e.jsx("div",{className:"mt-4 flex items-center justify-center",children:e.jsx(j,{})})]})]})]})};export{z as default};
